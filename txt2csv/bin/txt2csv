#!/usr/bin/env ruby
# this first line is how the operating system knows to use ruby to execute this file
# use chmod oug+x txt2csv to make sure the file is executable
require 'thor'
require_relative '../lib/parse'

class Txt2csv < Thor
  class_option :i, aliases: ['--input']
  class_option :o, aliases: ['--output']
  class_option :s, aliases: ['--suffix']
  class_option :p, aliases: ['--prefix']

  desc "analyze", "analyze customer data and output names histogram"
  def analyze
    if options[:p]
      regex = /^\S*/
    elsif options[:s]
      regex = /\S*$/
    else
       puts "You're broken"
    end
    histogram = Hash.new(0)
    File.open(options[:i]).each_line do |line|
      line_array = line.split("\t")
      name_string = line_array.shift
      matched_name = regex.match(name_string).to_s
      histogram[matched_name.to_sym] += 1
    end
    histogram = histogram.sort_by {|k, v| v}.reverse
    output_file = File.new(options[:o], "w+")
    output_file.puts(histogram.each {|x| puts x})
#I cannot figure out how to get this to output ['name', #] per line.
  end

  desc "convert", "convert customer data into CSV"
  def convert
    p_array = []
    s_array = []
    File.open(options[:p]).each_line { |x| p_array << x }
    File.open(options[:s]).each_line { |x| s_array << x }

    CSV.open(options[:o]) do |csv|
      File.open(options[:i]).each_line do |line|
        line_array = line.split("\t")
        name_string = line_array.shift
        one_line = []
        one_line << parse_names(p_array, s_array, name_string)
        one_line << parse_numbers(line_array.shift)
        one_line << parse_twitter(line_array.shift)
        one_line << parse_email(line_array)
        csv << one_line
      end
    end
  end
end
Txt2csv.start

#bin/txt2csv analyze -i lib/raw_customers.txt -o prefix_histogram.txt -p
#bin/txt2csv analyze -i lib/raw_customers.txt -o suffix_histogram.txt -s
#bin/txt2csv convert -p exp_prefix_histogram.txt -s exp_suffix_histogram.txt -i textfile.txt -o namefile.csv
